(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function i(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function r(t,e,i,n,r,o,s){try{var a=t[o](s),l=a.value}catch(t){return void i(t)}a.done?e(l):Promise.resolve(l).then(n,r)}function o(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var s=t.apply(e,i);function a(t){r(s,n,o,a,l,"next",t)}function l(t){r(s,n,o,a,l,"throw",t)}a(void 0)}))}}t.r(e),t.d(e,{default:()=>c});var s="ArrowDown";function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;return t.filter((function(t){return t.text.toLowerCase().startsWith(e.toLowerCase())}))}var l=function(t,e){var i=this,n=t.id;t.hidden=!0;var r=[],o=[];t.querySelectorAll("option").forEach((function(t){var e={value:t.value,text:t.textContent};t.disabled||r.push(e),t.defaultSelected&&o.push(t.value)}));var s=document.createElement("span");if(s.id=n+"-remove",s.innerText="remove",s.style.display="none",t.parentNode.appendChild(s),t.multiple){var a=document.createElement("ul");a.id=n+"-selected",a.classList.add("selected-options"),t.parentNode.appendChild(a),this.selectedEl=a}var l=document.createElement("div");l.classList.add("combo"),l.id="".concat(t.id,"-js-multi-buttons");var c=document.createElement("div");c.setAttribute("role","combobox"),c.setAttribute("aria-haspopup","listbox"),c.setAttribute("aria-expanded","false"),c.setAttribute("aria-owns",n+"-listbox"),c.classList.add("input-wrapper");var u=document.createElement("input");u.setAttribute("aria-activedescendant",""),u.setAttribute("aria-autocomplete","list"),u.setAttribute("aria-labelledby",n+"-label "+n+"-selected"),u.setAttribute("aria-controls",n+"-listbox"),u.id=n+"-input",u.classList.add("combo-input"),u.setAttribute("autocomplete","off"),u.setAttribute("type","text"),c.appendChild(u);var p=document.createElement("ul");p.setAttribute("role","listbox"),p.setAttribute("aria-multiselectable","true"),p.id=n+"-listbox",p.setAttribute("aria-labelledby",n+"-label"),p.classList.add("combo-menu"),l.appendChild(c),l.appendChild(p),t.parentNode.appendChild(l),this.select=t,this.el=l,this.comboEl=l.querySelector("[role=combobox]"),this.inputEl=l.querySelector("input"),this.listboxEl=l.querySelector("[role=listbox]"),this.idBase=this.inputEl.id,this.options=r,this.filteredOptions=r,this.source=e.source,this.minInput=e.minInput||2,this.page=1,this.morePages=!1,this.ajaxResultCount,this.activeIndex=0,this.open=!1,o.forEach((function(e){var n=i.options.find((function(t){return t.value===e}));if(t.multiple){var r=i.options.indexOf(n),o=document.createElement("button"),s=document.createElement("li");o.className="remove-option",o.type="button",o.id="".concat(i.idBase,"-remove-").concat(r),o.setAttribute("aria-describedby","".concat(i.idBase,"-remove")),o.dataset.value=n.value,o.addEventListener("click",(function(){i.removeOption(n)})),o.innerHTML=n.text+" ",s.appendChild(o),i.selectedEl.appendChild(s)}else i.inputEl.value=n.text}))};l.prototype.init=function(){var t=this,e=this,i=null;this.inputEl.addEventListener("input",o(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.source){n.next=4;break}return clearTimeout(i),n.next=4,new Promise((function(t){return i=setTimeout(t,500)}));case 4:e.onInput();case 5:case"end":return n.stop()}}),n)})))),this.inputEl.addEventListener("blur",this.onInputBlur.bind(this)),this.inputEl.addEventListener("focus",(function(){if(t.source){var e=t.listboxEl.querySelector("li[role=alert]"),i=!!e;e||(e=document.createElement("li")).setAttribute("role","alert"),e.innerText="Please enter ".concat(t.minInput," or more characters"),i||t.listboxEl.prepend(e)}t.updateMenuState(!0)})),this.inputEl.addEventListener("keydown",this.onInputKeyDown.bind(this))},l.prototype.filterOptions=function(){var t=o(regeneratorRuntime.mark((function t(e){var n,r,s,l,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e&&(this.clearOptions(),n=this.select.querySelectorAll("option:checked"),r=i(n).map((function(t){return t.innerText})),this.filteredOptions=this.source?this.options:a(this.options,e),s=this.source?this.ajaxResultCount:this.filteredOptions.length,l=document.createDocumentFragment(),this.filteredOptions.forEach((function(t,i){var n,a,u,p=r.includes(t.text),d=document.createElement("li");if(d.setAttribute("role","option"),s&&(d.setAttribute("aria-setsize",s),d.setAttribute("aria-posinset",i+1)),d.id="".concat(c.idBase,"-").concat(c.options.indexOf(t)),d.className="combo-option",d.setAttribute("aria-selected",p),d.dataset.value=t.value,d.innerText=t.text,p&&d.classList.add("option-selected"),d.addEventListener("click",(function(){c.onOptionClick(c.options.indexOf(t))})),d.addEventListener("mousedown",c.onOptionMouseDown.bind(c)),l.appendChild(d),c.source&&c.morePages&&t===c.filteredOptions[c.filteredOptions.length-1]){var h=document.createElement("li");h.setAttribute("role","alert"),h.innerText="Loading more results",l.appendChild(h),n=c.listboxEl,a=d,u=function(){var t=o(regeneratorRuntime.mark((function t(i){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i){t.next=6;break}return c.page++,t.next=4,c.updateResults();case 4:c.filterOptions(e),h.remove();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),new IntersectionObserver((function(t,e){t.forEach((function(t){u(t.isIntersecting)}))}),{root:n,threshold:.5}).observe(a)}})),this.listboxEl.appendChild(l));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),l.prototype.updateResults=o(regeneratorRuntime.mark((function t(){var e,i,n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(e=new URL(this.source,window.location.protocol+"//"+window.location.host)).search="".concat(e.search?e.search+"&":"?","q=").concat(this.inputEl.value,"&page=").concat(this.page),t.next=4,fetch(e);case 4:return i=t.sent,t.next=7,i.json();case 7:n=t.sent,1===this.page&&(this.options=[]),n.results.forEach((function(t){if(r.ajaxResultCount=n.total,!r.select.querySelector('option[value="'.concat(t.id,'"]'))){var e=document.createElement("option");e.value=t.id,e.innerText=t.text,r.select.appendChild(e)}var i={value:t.id,text:t.text};-1===r.options.indexOf(i)&&r.options.push(i)})),this.morePages=n.more||!1;case 11:case"end":return t.stop()}}),t,this)}))),l.prototype.onInput=o(regeneratorRuntime.mark((function t(){var e,i,n,r,o,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.inputEl.value,i=!1,n=this.listboxEl.querySelector("li[role=alert]"),this.page=1,!e){t.next=27;break}if(!this.source){t.next=21;break}if(!(e.length>=this.minInput)){t.next=15;break}return n||(n=document.createElement("li")).setAttribute("role","alert"),n.innerText="Loading results",this.listboxEl.prepend(n),t.next=12,this.updateResults();case 12:n.remove(),t.next=21;break;case 15:this.clearOptions(),null!==(r=n)&&void 0!==r||(n=document.createElement("li")),n.setAttribute("role","alert"),n.innerText="Please enter ".concat(this.minInput," or more characters"),this.listboxEl.prepend(n),i=!0;case 21:(!this.source||this.source&&e.length>=this.minInput)&&this.filterOptions(e),this.filteredOptions.indexOf(this.options[this.activeIndex])<0&&(o=this.options.indexOf(this.filteredOptions[0]),this.onOptionChange(o)),s=this.filteredOptions.length>0||i,this.open!==s&&this.updateMenuState(s),t.next=28;break;case 27:this.clearOptions();case 28:case"end":return t.stop()}}),t,this)}))),l.prototype.onInputKeyDown=function(t){var e=t.key,i=this.filteredOptions.length-1,n=this.filteredOptions.indexOf(this.options[this.activeIndex]),r=function(t,e){return e||t!==s?t===s?4:"ArrowUp"===t?6:"Home"===t?2:"End"===t?3:"Escape"===t?0:"Enter"===t?1:"Backspace"===t||"Clear"===t||1===t.length?9:void 0:5}(e,this.open);switch(r){case 4:case 3:case 2:case 6:t.preventDefault();var o=function(t,e,i){switch(i){case 2:return 0;case 3:return e;case 6:return Math.max(0,t-1);case 4:return Math.min(e,t+1);default:return t}}(n,i,r),a=this.options.indexOf(this.filteredOptions[o]);return this.onOptionChange(a);case 1:return t.preventDefault(),this.onOptionClick(this.activeIndex);case 0:return t.preventDefault(),this.updateMenuState(!1);case 5:return this.updateMenuState(!0)}},l.prototype.onInputBlur=function(){if(this.ignoreBlur)this.ignoreBlur=!1;else{if(this.inputEl.value="",!this.select.multiple){var t=this.select.querySelector("option:checked");t&&(this.inputEl.value=t.innerText)}""===this.inputEl.value&&this.clearOptions(),this.open&&this.updateMenuState(!1)}},l.prototype.onOptionChange=function(t){this.activeIndex=t,this.inputEl.setAttribute("aria-activedescendant","".concat(this.idBase,"-").concat(t));var e,n,r,o,s,a,l,c,u=this.el.querySelectorAll("[role=option]"),p=this.el.querySelector("[id=".concat(this.idBase,"-").concat(t,"]"));i(u).forEach((function(t){t.classList.remove("option-current")})),p&&(p.classList.add("option-current"),this.open&&(c=this.listboxEl)&&c.clientHeight<c.scrollHeight&&(e=p,n=this.listboxEl,r=e.offsetHeight,o=e.offsetTop,s=n.offsetHeight,l=o+r>(a=n.scrollTop)+s,o<a?n.scrollTo(0,o):l&&n.scrollTo(0,o-s+r)))},l.prototype.clearOptions=function(){i(this.el.querySelectorAll("[role=option]")).forEach((function(t){t.remove()}))},l.prototype.onOptionClick=function(t){this.updateOption(t),this.clearOptions(),this.updateMenuState(!1),this.inputEl.focus()},l.prototype.onOptionMouseDown=function(){this.ignoreBlur=!0},l.prototype.removeOption=function(t){var e=this.el.querySelector('[data-value="'.concat(t.value,'"]'));if(e&&(e.setAttribute("aria-selected","false"),e.classList.remove("option-selected")),this.selectedEl){var i=this.selectedEl.querySelector('[data-value="'.concat(t.value,'"]'));this.selectedEl.removeChild(i.parentElement)}this.select.querySelector('option[value="'+t.value+'"]').removeAttribute("selected")},l.prototype.selectOption=function(t){var e=this,i=this.options.indexOf(t),n=this.options[i];this.activeIndex=i;var r=this.el.querySelector("[id=".concat(this.idBase,"-").concat(i,"]"));r.setAttribute("aria-selected","true"),r.classList.add("option-selected");var o=document.createElement("button"),s=document.createElement("li");if(o.className="remove-option",o.type="button",o.id="".concat(this.idBase,"-remove-").concat(i),o.setAttribute("aria-describedby","".concat(this.idBase,"-remove")),o.dataset.value=n.value,o.addEventListener("click",(function(){e.removeOption(t)})),o.innerHTML=n.text+" ",s.appendChild(o),this.select.multiple)this.selectedEl.appendChild(s);else{var a=this.select.querySelector("option[selected]");a&&a.removeAttribute("selected")}this.select.querySelector('option[value="'+t.value+'"]').setAttribute("selected","selected")},l.prototype.updateOption=function(t){var e="true"===this.el.querySelector("[id=".concat(this.idBase,"-").concat(t,"]")).getAttribute("aria-selected");this.inputEl.value="",e?this.removeOption(this.options[t]):(this.selectOption(this.options[t]),this.select.multiple||(this.inputEl.value=this.options[t].text)),this.filterOptions("")},l.prototype.updateMenuState=function(t){this.open=t,this.comboEl.setAttribute("aria-expanded","".concat(t)),t?this.el.classList.add("open"):this.el.classList.remove("open")};const c=l})();